!function(){"use strict";class e{static enableDebug(e){this._debug=e}static log(e){this._debug&&console.log(`ExpTagManager: ${e}`)}static warn(e){this._debug&&console.warn(`ExpTagManager: ${e}`)}static error(e){this._debug&&console.error(`ExpTagManager: ${e}`)}}e._debug=!1;const t="identity",a="userEngagement",r="cart",o="search",n="catalog",i="order",s="error",c="cart",l="wish-list",d=["cart-add","cart-remove","cart-replace","cart-update","cart-view","checkout-begin","checkout-contact-info","checkout-user-register","checkout-shipping-address","checkout-billing-address","checkout-shipping-options","checkout-payment","checkout-apply-coupon","checkout-review","checkout-submit"],u=["wish-list-add","wish-list-remove","wish-list-replace","wish-list-update"],p={"cart-add":r,"cart-remove":r,"cart-replace":r,"cart-update":r,"cart-view":r,"checkout-begin":r,"checkout-contact-info":r,"checkout-user-register":r,"checkout-shipping-address":r,"checkout-billing-address":r,"checkout-shipping-options":r,"checkout-payment":r,"checkout-apply-coupon":r,"checkout-review":r,"checkout-submit":r,"wish-list-add":r,"wish-list-remove":r,"wish-list-replace":r,"wish-list-update":r,"catalog-object-view-start":n,"catalog-object-view-stop":n,"catalog-object-click":n,"catalog-object-impression":n,"form-submit":n,"user-engagement":a,"button-click":a,"anchor-click":a,"input-type-button-click":a,"input-type-submit-click":a,"input-type-reset-click":a,"page-scroll-to-bottom":a,"update-user-profile":a,"page-view":a,"email-update":"contactPointEmail","phone-update":"contactPointPhone","address-update":"contactPointAddress","order-accepted":i,"category-search":o,search:o,order:i,error:s},g="CRM_Id",h="ES_Identifier",v="Engagement",m="Profile",y="sftoken";class f{static getJsonFromDataLayer(t){let a;if(null!=t)try{a=JSON.parse(t.textContent.replace(/\s/g,""))}catch(t){e.log("Failed to parse data layer JSON")}return a}static getQueryStringForDataProviderType(e){return`script[type='application/json'][data-provider-type='${e}']`}static getCatalogObjectDataFromDataLayer(e,t){return Array.from(document.querySelectorAll(this.getQueryStringForDataProviderType("catalog"))).flatMap((e=>this.getJsonFromDataLayer(e))).filter((a=>a.type==t&&a.id==e))}static bytesToBase64(e){const t=String.fromCodePoint(...e);return btoa(t)}static isWellFormed(e){try{return encodeURIComponent(e),!0}catch(e){return!1}}}
/*! js-cookie v3.0.5 | MIT */function I(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)e[r]=a[r]}return e}!function e(t,a){function r(e,r,o){if("undefined"!=typeof document){"number"==typeof(o=I({},a,o)).expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var n="";for(var i in o)o[i]&&(n+="; "+i,!0!==o[i]&&(n+="="+o[i].split(";")[0]));return document.cookie=e+"="+t.write(r,e)+n}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var a=document.cookie?document.cookie.split("; "):[],r={},o=0;o<a.length;o++){var n=a[o].split("="),i=n.slice(1).join("=");try{var s=decodeURIComponent(n[0]);if(r[s]=t.read(i,s),e===s)break}catch(e){}}return e?r[e]:r}},remove:function(e,t){r(e,"",I({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,I({},this.attributes,t))},withConverter:function(t){return e(I({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(a)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});class P{static async get(t){if(t)try{const a=await fetch(t,{method:"GET"}),{status:r,statusText:o}=a;if(!(r<400)){throw new Error(`Get call failed on URL with status code ${r} and reason is: ${o}}`)}e.log(`Get call successful on URL ${t} with status code ${r}`)}catch(a){e.error(`Get call successful on URL ${t} with message ${a.message}`)}}}class b{static getCommonEventFields(e,t,a,r){const{site:o={},deviceIdentifier:n}=t,{siteId:i=window.location.host}=o;return{category:a,eventType:r,eventId:crypto.randomUUID(),dateTime:(new Date).toISOString(),deviceId:null==n?void 0:n.deviceId,sessionId:null==n?void 0:n.deviceId,interactionName:e,siteId:i}}static transformSearchResultToDLOFormat(e){var t;if(!e||0===Object.keys(e).length)return{};const a=null==e?void 0:e.id,r=null!==(t=null==e?void 0:e.attributes)&&void 0!==t?t:{},{title:o,absolutePosition:n,positionInPage:i,pageNumber:s,correlationId:c}=r;return{searchResultId:a,searchResultTitle:o,searchResultPosition:n,searchResultPositionInPage:i,searchResultPageNumber:s,correlationId:c}}static isIdentityEvent(e){const{name:a=""}=e||{};return a===t}static isPageViewEvent(e){const{name:t=""}=e||{};return"page-view"===t}static isEventFromCMSLandingPage(e){var t;const a=null===(t=null==e?void 0:e.source)||void 0===t?void 0:t.contentTypeName;return!(!a||"sfdc_cms__landingPage"!==a)}static isContactPointEvent(e){const{name:t=""}=e||{};return"email-update"===t||"phone-update"===t||"address-update"===t}static getWebstoreInfo(e){const{site:t={}}=e,{webstore:a={}}=t,{id:r="",...o}=a;return{webStoreId:r,...o}}static removeUndefinedAndNullAttributes(e){const{events:t}=e,a=[];return t.forEach((e=>{const t={};Object.keys(e).forEach((a=>{e[a]&&(t[a]=e[a])})),a.push(t)})),{events:a}}static callTrackingServiceEndpoint(t){var a,r;const o=this.getQueryParamValue(y);if(o){const{deviceIdentifier:{deviceId:n}}=t,i=null===(r=null===(a=window.expTagMgrConfig)||void 0===a?void 0:a.UMA)||void 0===r?void 0:r.trackingSvcEndpoint;if(i)try{const e=new URL(`https://${i}/link?${y}=${o}&deviceId=${n}`);P.get(e.href.replace(/([^:]\/)\/+/g,"$1"))}catch(t){e.error("UMA tracking service endpoint is not a valid URL")}}}static getQueryParamValue(e){return new URLSearchParams(window.location.search).get(e)}}class C{static createContactPointPayload(e,t){const a=b.getCommonEventFields(null==t?void 0:t.name,e,m,p[null==t?void 0:t.name]),{name:r,...o}=t;return{...a,...o}}}class E{static createErrorPayloadFromErrorInteraction(e,t,a){const r=this.createPartialPayload(e,t,a),{id:o}=e;return{errorId:o,...r}}static createErrorPayloadFromErrorField(e,t,a,r){let o=null;if(e&&r){o={errorId:r,...this.createPartialPayload(e,t,a)}}return o}static createPartialPayload(e,t,a){const r=b.getCommonEventFields(a,t,v,s),o=null==e?void 0:e.attributes,{message:n,type:i,code:c,...l}=o;return{...r,errorCode:c,errorMessage:n,errorType:i,...l}}}class w{static createIdentityPayload(e,a=null){const{user:r}=e,o=null!=r?r:{attributes:{}},n=b.getCommonEventFields("identity",e,m,"identity"),{attributes:i,crmId:s}=o;let c={...n,...{isAnonymous:s?"0":"1",...i}};if((null==a?void 0:a.name)===t){const{name:e,...t}=a;c={...c,...t}}return c}}class S{static createCatalogObjectsPayload(e,t){const{name:r,catalogObjects:o}=e,i=[];let s=null;o&&(s=Array.isArray(o)?o[0].type:o.type);let c=a;s&&"Product"===s&&(c=n);const l=b.getCommonEventFields(r,t,v,c);return o?Array.isArray(o)?o.forEach((e=>{i.push(this.createCatalogObjectPayload(e,l))})):i.push(this.createCatalogObjectPayload(o,l)):i.push({...l}),i}static createCatalogObjectPayload(e,t){const{id:r,type:o,attributes:n}=e,{eventType:i}=t,s=f.getCatalogObjectDataFromDataLayer(r,o),c=Object.assign({},...s.map((e=>e.attributes)));let l={};return l=i===a?{catalogObjectId:r,catalogObjectType:o}:{id:r,type:o},{...l,...c,...n,...t}}}class k{static createSourcePayload(e){const t=null!=e?e:{},{urlReferrer:a,url:r,locale:o,type:n,channel:i,pageId:s,title:c,name:l,urlAlias:d}=t;return{sourceUrlReferrer:a,sourceUrl:r,sourceLocale:o,sourceChannel:i,sourcePageType:n,sourcePageId:s,sourcePageTitle:c,sourcePageName:l,sourceUrlAlias:d}}}class F{static createCartOrWishListPayload(e,t,a,r){var o,n,i,s,d,u;const{name:p}=e;let g,h,v,m;const y=b.getWebstoreInfo(t);r===l?(g=null!==(o=e.wishList)&&void 0!==o?o:{},h=null!==(n=g.lineItems)&&void 0!==n?n:[],v=null!==(i=g.attributes)&&void 0!==i?i:{},m=null==g?void 0:g.id):r===c&&(g=null!==(s=e.cart)&&void 0!==s?s:{},h=null!==(d=g.lineItems)&&void 0!==d?d:[],v=null!==(u=g.attributes)&&void 0!==u?u:{},m=null==g?void 0:g.id);const{eventId:f}=a,I={id:m,...a,...v,...y},P=[];return Array.isArray(h)?h.forEach((e=>{P.push(this.createCartOrWishListItemPayload(e,f,p,t))})):P.push(this.createCartOrWishListItemPayload(h,f,p,t)),[I,...P]}static createCartOrWishListItemPayload(e,t,a,r){var o;const{id:n,attributes:i}=e,s=null!==(o=null==e?void 0:e.catalogObject)&&void 0!==o?o:{},{id:c,type:l,attributes:d}=s;return{...b.getCommonEventFields(a,r,v,"cartItem"),cartEventId:t,lineItemId:n,...i,catalogObjectId:c,catalogObjectType:l,...d}}}class O{static createSearchPayload(e,t){var a;const{searchQuery:r,categoryId:o}=e,n=null!==(a=null==e?void 0:e.attributes)&&void 0!==a?a:{},{searchFacetList:i,searchType:s,...c}=n;return{...t,searchQuery:r,categoryId:o,searchFacetList:null==i?void 0:i.toString(),searchType:null==s?void 0:s.toString(),...c}}}class T{static createOrderPayload(e,t){const{order:a}=e,{id:r,attributes:o}=a;return{...t,id:r,...o}}}class D{static createInteractionPayload(e,t){const{source:g,searchResult:h={},screenInfo:m,personalization:y={},userAgent:f,component:I={},catalogObjects:P={}}=t,{name:C,status:w}=e;let D=[];const R=b.getWebstoreInfo(t);if(p[C]===n){D=S.createCatalogObjectsPayload(e,t).map((e=>({...P,...e,...m,...I,...f,...k.createSourcePayload(g),...b.transformSearchResultToDLOFormat(h),...y,...R,eventStatus:w})))}else if(p[C]===r){const a=b.getCommonEventFields(C,t,v,r);u.includes(C)?D=F.createCartOrWishListPayload(e,t,a,l):d.includes(C)&&(D=F.createCartOrWishListPayload(e,t,a,c)),D[0]={...D[0],...m,...I,...f,...k.createSourcePayload(g),...b.transformSearchResultToDLOFormat(h),...y,eventStatus:w}}else if(p[C]===o){const a=b.getCommonEventFields(C,t,v,o),r={...O.createSearchPayload(e,a),...m,...I,...f,...k.createSourcePayload(g),...R,eventStatus:w};D.push(r)}else if(p[C]===s){const a={...E.createErrorPayloadFromErrorInteraction(e,t,C),...m,...I,...f,...R,...k.createSourcePayload(g)};D.push(a)}else if(p[C]===i){const a=b.getCommonEventFields(C,t,v,i),r={...T.createOrderPayload(e,a),...m,...I,...f,...k.createSourcePayload(g),...R,eventStatus:w};D.push(r)}else{const{name:r,...o}=e,{attributes:n={},...i}=o,s={...b.getCommonEventFields(r,t,v,a),...m,...I,...f,...k.createSourcePayload(g),...n,...i,...b.transformSearchResultToDLOFormat(h),...y,...R,eventStatus:w};D.push(s)}return D}}class R{static createPartyIdentificationPayload(e){var t;const{user:a,deviceIdentifier:r}=e,o=null!=a?a:{attributes:{}},n=b.getCommonEventFields("identity",e,m,"partyIdentification"),{crmId:i}=o,s=null!==(t=o.attributes)&&void 0!==t?t:{},{identityResolution:c}=s;let l=null;if(i&&!c){const e=`${null==r?void 0:r.deviceId}_${h}_${g}`;l={...n,IDName:g,IDType:h,userId:i,partyIdentificationId:e}}else if(c){const{partyIdentification:e={}}=c,{idName:t,id:a,idType:r,idNumber:o}=e;a&&o&&(l={...n,IDName:t,IDType:r,userId:o,partyIdentificationId:a})}return l}}class j{static createDataCloudEventPayload(e,t){const a=[];if(b.isIdentityEvent(e)){const r=w.createIdentityPayload(t,e);a.push(r)}else if(b.isContactPointEvent(e)){const r=C.createContactPointPayload(t,e);a.push(r)}else{if(b.isPageViewEvent(e)&&(b.callTrackingServiceEndpoint(t),!b.isEventFromCMSLandingPage(t))){const e=w.createIdentityPayload(t);a.push(e);const r=R.createPartyIdentificationPayload(t);r&&a.push(r)}const r=D.createInteractionPayload(e,t);a.push(...r);const o=E.createErrorPayloadFromErrorField(null==e?void 0:e.error,t,null==e?void 0:e.name,r[0].eventId);o&&a.push(o)}return a}}var L;null===(L=window.ECEngmtEvtDispatchers)||void 0===L||L.push({dispatcherName:"DataCloud",dispatcher:new class{sendEvent(t){const{tenantSpecificEndpoint:a,appSourceId:r}=window.expTagMgrConfig.dataCloud;if(a&&r)if(f.isWellFormed(t)){const e=f.bytesToBase64((new TextEncoder).encode(t)),o=encodeURIComponent(e);let n="";const i=`/web/events/${r}?event=`;n=a.includes("https://")?`${a}${i}`:`https://${a}${i}`,P.get(`${n}${o}`)}else e.log("Payload is not well formed");else e.log("Invalid DC configuration")}send(t,a){var r;if(!(null===(r=window.expTagMgrConfig)||void 0===r?void 0:r.dataCloud)||!a||"0"===a.dataUsePurpose)return void e.log("Could not send event as all conditions are not evaluating to true");const{interactions:o,...n}=t,i=[];if(o.length>1?o.forEach((e=>{(null==e?void 0:e.name)&&i.push(...j.createDataCloudEventPayload(e,{...n}))})):i.push(...j.createDataCloudEventPayload(o[0],{...n})),i.length){const e={events:i},t=b.removeUndefinedAndNullAttributes(e);this.sendEvent(JSON.stringify(t))}}}})}();
